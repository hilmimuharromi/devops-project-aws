---
- name: Setup Web server
  hosts: localhost
  become: yes
  become_user: root

  tasks:
  - name: Update all packages to their latest version
    apt:
      name: "*"
      state: latest


  - name: Install fontconfig
    shell: apt install fontconfig -y    

  - name: Install java
    shell: apt install fontconfig openjdk-17-jre -y  

  - name: Checking java version
    shell: java -version  

  - name: Add pgdg repo to sources.list.d
      lineinfile:
        path: /etc/apt/sources.list.d/pgdg.list
        line: "deb http://apt.postgresql.org/pub/repos/apt {{ ansible_distribution_release }}-pgdg main"
        create: true
  
  - name: Download PostgreSQL key and add it to system keyring
      apt_key:
        url: https://www.postgresql.org/media/keys/ACCC4CF8.asc
        state: present
  
  - name: Update apt cache
      apt:
        update_cache: yes

  - name: Install PostgreSQL
      apt:
        name: postgresql
        state: present

  - name: update
      apt: update_cache=yes   
   
  - name: Install Nginx
      apt: name=nginx state=latest

      notify:
        - restart nginx

handlers:
  - name: restart nginx
    service: name=nginx state=reloaded
